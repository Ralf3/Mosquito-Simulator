# Run a Simulation
## Change the control.jl

Please open the control file control.jl and have a look at it. Control.jl controls the simulation and contains all configuration options. Before we start a simulation, you can make a small adjustment. We want to add 20 infected birds to the simulation region at step 20, i.e. 20 days after the start of the simulation.

- infstepIB=20
- addIB=20

Then save control.jl

### Start the Simulation
**include("control.jl")**

Normally the simulation starts very fast. However, the first time some Julia packages have to be compiled, which may take a few minutes. Please be patient. You can see that the simulation is running by the output of the simulation in form of a table. This is in my eyes better than a progress bar.

When the simulation is finished, a **show_resb()** image will appear. It shows the dynamics of the WestNile fever in the birds. You can clearly see the spade around step 20. There 20 infected birds were introduced.
![Bird Dynamics](/doc/picts/show_resb.png)

The same can be displayed for the mosquito dynamic **show_resm()**:
![Mosquito Dynamics](/doc/picts/show_resm.png)

The dynamics give a first overview of the simulation. Normally, common models end here. However, in Mosquito Simulator there is a second part that simulates the movement of mosquitoes in the region and visualizes the spatial distribution of birds. Let's start with the birds.

The following image shows the distribution of infectious birds throughout the simulation **show_map_b(13)**:
![Infectious Birds](/doc/picts/show_map_b_13.png)

The following picture shows the birds recovered from their disease **show_map_b(4)**:
![Recoverd Birds](/doc/picts/show_map_b_4.png)

In the last bird picture the birds that died are shown **show_map_b(5)**:
![Dead Birds](/doc/picts/show_map_b_5.png)

So far to the birds. Now let's move on to the mosquitoes. The mosquitoes can move freely in the region, whereas the birds are bound to their nesting sites. Also, the mosquitoes show a much greater dynamic, which suggests a denser occupation of the region with mosquitoes.

The occupancy of the region at the end of the simulation  **show_map_m(2)**:
![Mosquitoes at the end of Simulation](/doc/picts/show_map_m_2.png)

The occupancy of the region over of the simulation  **show_map_m(12)**:
![Mosquitoes over the Simulation](/doc/picts/show_map_m_12.png)

The occupancy of infected Mosquitoes over of the simulation  **show_map_m(14)**:
![Mosquitoes over the Simulation](/doc/picts/show_map_m_14.png)

It is interesting that the number of infectious mosquitoes appears comparatively low over the entire simulation. However, one should keep in mind that these mosquitoes can fly freely and thus can reach any bird. Also it has to be considered that the mosquitoes are only a selection of the mosquitoes really living in the region. They were scaled around 1:10000. One mosquito thus corresponds to a so-called "super mosquito". (One super mosquito in the simulation is about 10000 mosquitoes in reality).

The Mosquito simulator allows to select any point of time of the simulation by means of the **switch(int)**. This is important for detailed analysis of a simulation. **switch(string)** allows to switch in the background of the mosquito images between the settlement (default), the habitat model of the mosquitoes and the river.  For the birds the change remains ineffective, they always show the settlement.

The analysis of a simulation can be evaluated in detail using the table **dfx**. **dfx** stores the dynamics of mosquitoes and birds for each simulation step.

**dfx**:
![dfx](/doc/picts/dfx.png)

One, in my opinion interesting use of **dfx** is shown in the following boxplot:
![Boxplot](/doc/picts/boxplot.png)

This boxplot is generated by the command: @df dfx boxplot(label=["IM" "IB"],[:IM,:IB]). It clearly shows that in the selected simulation the latent infection is in the mosquitoes, not in the birds. 

To conclude this introduction, important details for the control of the simulation should be pointed out. The table **df** shows the most important parameters of a simulation. These are stored in the file simlation.csv. Also the simulator stores the **dfx** under results and the **controls.jl** under controls. (If these directories do not exist they will be created). Thus, once executed simulations are repeatable by renaming **control_{ID}.jl** to **control.jl**. This allows extensive analysis of scenarios. 
